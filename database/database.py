# [file database/database.py] 
# Инициализация базы данных SQLite

import sqlite3
import os
from datetime import datetime
from pathlib import Path

# ---- DB path / connection helpers ----
# Единый путь к файлу БД:
#   1) MICROBIOLOGY_DB_PATH (если задан)
#   2) <project_root>/data/microbiology.db

ENV_DB_PATH = "MICROBIOLOGY_DB_PATH"
DEFAULT_DB_FILENAME = "microbiology.db"

def _project_root() -> Path:
    """Определяет корень проекта относительно расположения этого файла."""
    p = Path(__file__).resolve()
    # ожидаемо: <root>/database/database.py
    if p.parent.name.lower() == "database":
        return p.parent.parent
    return p.parent

def _default_db_path() -> Path:
    return _project_root() / "data" / DEFAULT_DB_FILENAME

def _normalize_db_path(db_path: str | Path | None = None) -> Path:
    if db_path:
        return Path(db_path).expanduser().resolve()
    env = os.getenv(ENV_DB_PATH)
    if env:
        return Path(env).expanduser().resolve()
    return _default_db_path()

def _apply_pragmas(conn: sqlite3.Connection) -> None:
    # снижает вероятность 'database is locked' и делает поведение предсказуемее
    try:
        conn.execute("PRAGMA foreign_keys = ON;")
        conn.execute("PRAGMA busy_timeout = 5000;")
        conn.execute("PRAGMA journal_mode = WAL;")
        conn.execute("PRAGMA synchronous = NORMAL;")
    except Exception:
        pass

def get_connection(db_path: str | Path | None = None, readonly: bool = False) -> sqlite3.Connection:
    p = _normalize_db_path(db_path)
    p.parent.mkdir(parents=True, exist_ok=True)
    if readonly:
        return sqlite3.connect(f"file:{p.as_posix()}?mode=ro", uri=True, timeout=10)
    conn = sqlite3.connect(str(p), timeout=10)
    _apply_pragmas(conn)
    return conn

def ensure_database(db_path: str | Path | None = None) -> str:
    """Гарантирует существование БД, таблиц и начального наполнения."""
    init_database(db_path=db_path)
    return str(_normalize_db_path(db_path))


def create_tables(cursor: sqlite3.Cursor) -> None:
    """Создание всех таблиц (idempotent)."""
    # Таблица для микроорганизмов
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS microorganisms (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        genus TEXT NOT NULL,
        species TEXT NOT NULL,
        strain TEXT,
        gram_staining TEXT,
        morphology TEXT,
        metabolism TEXT,
        ph_optimum REAL,
        temperature_optimum REAL,
        growth_rate REAL,
        model_type TEXT,
        k_constant REAL,
        y_constant REAL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')

    # Таблица для питательных сред
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS culture_media (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        media_type TEXT NOT NULL,
        name TEXT NOT NULL UNIQUE,
        composition TEXT,
        ph REAL,
        color TEXT,
        consistency TEXT,
        preparation_method TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')

    # Таблица для веществ-компонентов
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS substances (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        substance_class TEXT NOT NULL,
        name TEXT NOT NULL UNIQUE,
        formula TEXT,
        molecular_weight REAL,
        solubility TEXT,
        energy_value REAL,
        toxic_concentration REAL,
        description TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')

    # Таблица для типов взаимодействий
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS interactions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        base_type TEXT NOT NULL,
        mechanism TEXT NOT NULL,
        description TEXT,
        mathematical_model TEXT,
        alpha_coefficient REAL,
        beta_coefficient REAL,
        distance_effect REAL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')

    # Таблица для параметров биореактора
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS bioreactor_params (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        system_type TEXT NOT NULL,
        configuration TEXT NOT NULL,
        volume REAL,
        area REAL,
        stirring_speed REAL,
        mass_transfer_coefficient REAL,
        material TEXT,
        oxygen_transfer_rate REAL,
        description TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')

    # Таблица для антимикробных агентов
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS antimicrobials (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        agent_class TEXT NOT NULL,
        name TEXT NOT NULL UNIQUE,
        target TEXT,
        typical_mic TEXT,
        resistance_mechanism TEXT,
        concentration_unit TEXT,
        spectrum TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')

    # Таблица для метаболических путей
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS metabolic_pathways (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        product_type TEXT NOT NULL,
        product_name TEXT NOT NULL UNIQUE,
        producing_strains TEXT,
        biosynthesis_pathway TEXT,
        optimal_ph REAL,
        optimal_temperature REAL,
        growth_phase TEXT,
        yield REAL,
        description TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')

    # Таблица для экспериментальных протоколов
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS experimental_protocols (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        experiment_purpose TEXT NOT NULL,
        protocol_name TEXT NOT NULL UNIQUE,
        step_by_step TEXT,
        materials TEXT,
        calculation_formulas TEXT,
        "references" TEXT,
        duration_minutes INTEGER,
        difficulty_level TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')

def init_database(db_path: str | Path | None = None) -> None:
    """Инициализация базы данных и создание таблиц."""
    db_file = _normalize_db_path(db_path)
    db_file.parent.mkdir(parents=True, exist_ok=True)

    conn = get_connection(db_file, readonly=False)
    try:
        cursor = conn.cursor()
        create_tables(cursor)
        conn.commit()

        # Проверяем и предзаполняем данные если таблицы пусты
        prefill_data(cursor, conn)
    finally:
        try:
            conn.close()
        except Exception:
            pass
    print("База данных инициализирована успешно!")
def prefill_data(cursor, conn):
    """Предзаполнение данными всех справочников"""
    
    # Микроорганизмы (25 записей)
    microorganisms_data = [
        ('Escherichia', 'coli', 'K-12', 'Negative', 'Rod', 'Facultative anaerobic', 7.0, 37.0, 0.5, 'Monod', 0.01, 0.5),
        ('Escherichia', 'coli', 'O157:H7', 'Negative', 'Rod', 'Facultative anaerobic', 7.2, 37.0, 0.6, 'Monod', 0.015, 0.48),
        ('Bacillus', 'subtilis', '168', 'Positive', 'Rod', 'Aerobic', 7.0, 30.0, 0.3, 'Monod', 0.02, 0.45),
        ('Bacillus', 'cereus', 'ATCC 14579', 'Positive', 'Rod', 'Facultative anaerobic', 6.8, 30.0, 0.35, 'Monod', 0.025, 0.4),
        ('Staphylococcus', 'aureus', 'ATCC 25923', 'Positive', 'Coccus', 'Facultative anaerobic', 7.3, 37.0, 0.4, 'Monod', 0.03, 0.42),
        ('Staphylococcus', 'epidermidis', 'ATCC 14990', 'Positive', 'Coccus', 'Facultative anaerobic', 7.0, 37.0, 0.35, 'Monod', 0.028, 0.38),
        ('Pseudomonas', 'aeruginosa', 'PAO1', 'Negative', 'Rod', 'Aerobic', 7.2, 37.0, 0.45, 'Monod', 0.018, 0.47),
        ('Pseudomonas', 'putida', 'KT2440', 'Negative', 'Rod', 'Aerobic', 7.0, 30.0, 0.4, 'Monod', 0.022, 0.43),
        ('Salmonella', 'enterica', 'Typhimurium LT2', 'Negative', 'Rod', 'Facultative anaerobic', 7.0, 37.0, 0.55, 'Monod', 0.012, 0.5),
        ('Salmonella', 'typhi', 'Ty2', 'Negative', 'Rod', 'Facultative anaerobic', 7.1, 37.0, 0.5, 'Monod', 0.014, 0.48),
        ('Lactobacillus', 'acidophilus', 'NCFM', 'Positive', 'Rod', 'Anaerobic', 6.5, 37.0, 0.25, 'Monod', 0.035, 0.35),
        ('Lactobacillus', 'casei', 'BL23', 'Positive', 'Rod', 'Anaerobic', 6.8, 37.0, 0.28, 'Monod', 0.032, 0.36),
        ('Saccharomyces', 'cerevisiae', 'S288C', 'Gram-variable', 'Oval', 'Facultative anaerobic', 5.5, 30.0, 0.2, 'Monod', 0.04, 0.3),
        ('Saccharomyces', 'boulardii', 'CNCM I-745', 'Gram-variable', 'Oval', 'Facultative anaerobic', 5.5, 37.0, 0.22, 'Monod', 0.038, 0.32),
        ('Streptococcus', 'pyogenes', 'MGAS5005', 'Positive', 'Coccus', 'Facultative anaerobic', 7.2, 37.0, 0.38, 'Monod', 0.026, 0.4),
        ('Streptococcus', 'pneumoniae', 'TIGR4', 'Positive', 'Coccus', 'Facultative anaerobic', 7.3, 37.0, 0.35, 'Monod', 0.029, 0.39),
        ('Mycobacterium', 'tuberculosis', 'H37Rv', 'Positive', 'Rod', 'Aerobic', 6.8, 37.0, 0.15, 'Monod', 0.05, 0.25),
        ('Mycobacterium', 'smegmatis', 'mc² 155', 'Positive', 'Rod', 'Aerobic', 7.0, 37.0, 0.18, 'Monod', 0.045, 0.28),
        ('Clostridium', 'difficile', '630', 'Positive', 'Rod', 'Anaerobic', 6.5, 37.0, 0.2, 'Monod', 0.04, 0.3),
        ('Clostridium', 'botulinum', 'ATCC 3502', 'Positive', 'Rod', 'Anaerobic', 7.0, 30.0, 0.18, 'Monod', 0.042, 0.28),
        ('Vibrio', 'cholerae', 'O1 biovar El Tor', 'Negative', 'Curved rod', 'Facultative anaerobic', 8.0, 37.0, 0.42, 'Monod', 0.02, 0.45),
        ('Vibrio', 'fischeri', 'ES114', 'Negative', 'Curved rod', 'Facultative anaerobic', 7.5, 25.0, 0.3, 'Monod', 0.025, 0.4),
        ('Enterococcus', 'faecalis', 'OG1RF', 'Positive', 'Coccus', 'Facultative anaerobic', 7.0, 37.0, 0.32, 'Monod', 0.03, 0.38),
        ('Enterococcus', 'faecium', 'TX0016', 'Positive', 'Coccus', 'Facultative anaerobic', 7.1, 37.0, 0.3, 'Monod', 0.031, 0.36),
        ('Neisseria', 'gonorrhoeae', 'FA1090', 'Negative', 'Diplococcus', 'Aerobic', 7.2, 37.0, 0.28, 'Monod', 0.035, 0.34),
        ('Neisseria', 'meningitidis', 'MC58', 'Negative', 'Diplococcus', 'Aerobic', 7.3, 37.0, 0.3, 'Monod', 0.033, 0.35)
    ]
    
    cursor.execute("SELECT COUNT(*) FROM microorganisms")
    if cursor.fetchone()[0] == 0:
        cursor.executemany('''
        INSERT INTO microorganisms (genus, species, strain, gram_staining, morphology, metabolism, 
                                   ph_optimum, temperature_optimum, growth_rate, model_type, k_constant, y_constant)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        ''', microorganisms_data)
    
    # Питательные среды (20 записей)
    culture_media_data = [
        ('Базовая', 'LB Broth (Luria-Bertani)', 'Триптон 10 г/л, дрожжевой экстракт 5 г/л, NaCl 10 г/л', 7.0, 'Соломенно-желтый', 'Жидкая', 'Растворить компоненты в дистиллированной воде, автоклавировать 15 мин при 121°C'),
        ('Минимальная', 'M9 Minimal Medium', 'Na2HPO4 6 г/л, KH2PO4 3 г/л, NaCl 0.5 г/л, NH4Cl 1 г/л, глюкоза 2 г/л', 7.0, 'Бесцветная', 'Жидкая', 'Стерилизовать компоненты отдельно, смешать после охлаждения'),
        ('Селективная', 'MacConkey Agar', 'Пептон 20 г/л, лактоза 10 г/л, желчь 1.5 г/л, кристаллический фиолетовый 0.001 г/л, нейтральный красный 0.03 г/л', 7.1, 'Красный', 'Твердая', 'Автоклавировать 15 мин при 121°C, охладить до 50°C, разлить в чашки'),
        ('Дифференциальная', 'Blood Agar', 'Триптон 15 г/л, дрожжевой экстракт 5 г/л, NaCl 5 г/л, агар 15 г/л, дефибринированная кровь 5%', 7.3, 'Красный', 'Твердая', 'Стерилизовать основу, охладить до 45°C, добавить кровь, разлить'),
        ('Селективная', 'Mannitol Salt Agar', 'Пептон 10 г/л, маннитол 10 г/л, NaCl 75 г/л, агар 15 г/л, феноловый красный 0.025 г/л', 7.4, 'Красный', 'Твердая', 'Автоклавировать 15 мин при 121°C'),
        ('Минимальная', 'Davis Minimal Medium', 'K2HPO4 7 г/л, KH2PO4 2 г/л, (NH4)2SO4 1 г/л, цитрат натрия 0.5 г/л', 7.0, 'Бесцветная', 'Жидкая', 'Стерилизовать автоклавированием'),
        ('Базовая', 'Nutrient Broth', 'Пептон 5 г/л, мясной экстракт 3 г/л', 6.8, 'Светло-коричневый', 'Жидкая', 'Растворить, автоклавировать 15 мин'),
        ('Базовая', 'Tryptic Soy Broth', 'Триптический перевар казеина 17 г/л, перевар соевой муки 3 г/л, NaCl 5 г/л, K2HPO4 2.5 г/л, глюкоза 2.5 г/л', 7.3, 'Соломенный', 'Жидкая', 'Автоклавировать 15 мин'),
        ('Селективная', 'XLD Agar', 'Дрожжевой экстракт 3 г/л, лактоза 7.5 г/л, сахароза 7.5 г/л, ксилоза 3.75 г/л, тиосульфат натрия 6.8 г/л', 7.4, 'Красный', 'Твердая', 'Автоклавировать, охладить, добавить дезоксихолат натрия'),
        ('Дифференциальная', 'EMB Agar', 'Пептон 10 г/л, лактоза 10 г/л, эозин Y 0.4 г/л, метиленовый синий 0.065 г/л', 7.2, 'Фиолетовый', 'Твердая', 'Автоклавировать 15 мин'),
        ('Селективная', 'Sabouraud Dextrose Agar', 'Пептон 10 г/л, декстроза 40 г/л, агар 15 г/л', 5.6, 'Соломенный', 'Твердая', 'Автоклавировать 15 мин'),
        ('Минимальная', 'Czapek Dox Agar', 'Сахара 30 г/л, NaNO3 2 г/л, K2HPO4 1 г/л, MgSO4 0.5 г/л, KCl 0.5 г/л', 7.3, 'Прозрачный', 'Твердая', 'Автоклавировать 15 мин'),
        ('Базовая', 'Brain Heart Infusion', 'Мозговой настой 200 г/л, сердечный настой 250 г/л, пептон 10 г/л, глюкоза 2 г/л, NaCl 5 г/л', 7.4, 'Коричневый', 'Жидкая', 'Автоклавировать 15 мин'),
        ('Селективная', 'Baird-Parker Agar', 'Триптический перевар 10 г/л, дрожжевой экстракт 5 г/л, лития хлорид 5 г/л, теллурит калия 0.1 г/л', 7.0, 'Черный', 'Твердая', 'Стерилизовать, добавить яичный желток'),
        ('Дифференциальная', 'TCBS Agar', 'Дрожжевой экстракт 5 г/л, пептон 10 г/л, сахароза 20 г/л, тиосульфат натрия 10 г/л', 8.6, 'Зеленый', 'Твердая', 'Автоклавировать 15 мин'),
        ('Минимальная', 'Glycerol Minimal Medium', '(NH4)2SO4 2 г/л, K2HPO4 14 г/л, KH2PO4 6 г/л, цитрат натрия 1 г/л, глицерин 10 мл/л', 7.0, 'Прозрачный', 'Жидкая', 'Стерилизовать автоклавированием'),
        ('Базовая', 'YPD Medium', 'Дрожжевой экстракт 10 г/л, пептон 20 г/л, глюкоза 20 г/л', 6.5, 'Соломенный', 'Жидкая', 'Стерилизовать фильтрованием'),
        ('Селективная', 'Cetrimide Agar', 'Пептон 20 г/л, MgCl2 1.4 г/л, K2SO4 10 г/л, цетримид 0.3 г/л', 7.2, 'Зеленый', 'Твердая', 'Автоклавировать 15 мин'),
        ('Дифференциальная', 'CLED Agar', 'Пептон 4 г/л, казеиновый перевар 4 г/л, лактоза 10 г/л, бромтимоловый синий 0.02 г/л', 7.3, 'Синий/зеленый', 'Твердая', 'Автоклавировать 15 мин'),
        ('Минимальная', 'Minimal Salts Medium', 'K2HPO4 7 г/л, KH2PO4 3 г/л, NaCl 0.5 г/л, NH4Cl 1 г/л, MgSO4 0.24 г/л', 7.0, 'Прозрачный', 'Жидкая', 'Автоклавировать 15 мин')
    ]
    
    cursor.execute("SELECT COUNT(*) FROM culture_media")
    if cursor.fetchone()[0] == 0:
        cursor.executemany('''
        INSERT INTO culture_media (media_type, name, composition, ph, color, consistency, preparation_method)
        VALUES (?, ?, ?, ?, ?, ?, ?)
        ''', culture_media_data)
    
    # Вещества-компоненты (25 записей)
    substances_data = [
        ('Источник углерода', 'Глюкоза', 'C6H12O6', 180.16, 'Хорошо растворим', 3.8, 500.0, 'Основной источник энергии для многих микроорганизмов'),
        ('Источник углерода', 'Лактоза', 'C12H22O11', 342.30, 'Хорошо растворим', 3.7, 400.0, 'Дисахарид, используется в дифференциальных средах'),
        ('Источник углерода', 'Сахароза', 'C12H22O11', 342.30, 'Хорошо растворим', 3.7, 450.0, 'Дисахарид, источник энергии'),
        ('Источник углерода', 'Глицерин', 'C3H8O3', 92.09, 'Хорошо растворим', 4.2, 300.0, 'Трехатомный спирт, источник углерода'),
        ('Источник углерода', 'Маннитол', 'C6H14O6', 182.17, 'Растворим', 3.6, 350.0, 'Сахарный спирт, используется в селективных средах'),
        ('Источник азота', 'Пептон', 'Смесь пептидов', None, 'Хорошо растворим', 4.0, 1000.0, 'Частично гидролизованный белок'),
        ('Источник азота', 'Триптон', 'Триптический перевар казеина', None, 'Хорошо растворим', 4.1, 1200.0, 'Ферментативный гидролизат казеина'),
        ('Источник азота', 'Дрожжевой экстракт', 'Комплекс витаминов и аминокислот', None, 'Хорошо растворим', 4.3, 1500.0, 'Автолизат дрожжевых клеток'),
        ('Источник азота', 'Аммоний хлористый', 'NH4Cl', 53.49, 'Хорошо растворим', 1.2, 50.0, 'Неорганический источник азота'),
        ('Источник азота', 'Нитрат калия', 'KNO3', 101.10, 'Хорошо растворим', 1.5, 60.0, 'Источник азота и калия'),
        ('Соли', 'Хлорид натрия', 'NaCl', 58.44, 'Хорошо растворим', 0.0, 100.0, 'Регулятор осмотического давления'),
        ('Соли', 'Сульфат магния', 'MgSO4·7H2O', 246.47, 'Хорошо растворим', 0.0, 40.0, 'Источник магния и серы'),
        ('Соли', 'Фосфат калия', 'K2HPO4', 174.18, 'Хорошо растворим', 0.0, 80.0, 'Буферный агент, источник фосфора'),
        ('Соли', 'Хлорид кальция', 'CaCl2', 110.98, 'Хорошо растворим', 0.0, 30.0, 'Источник кальция, кофактор ферментов'),
        ('Буфер', 'Фосфатный буфер', 'Смесь K2HPO4 и KH2PO4', None, 'Растворим', 0.0, None, 'Поддерживает pH в диапазоне 6.0-8.0'),
        ('Буфер', 'Tris-HCl', 'C4H11NO3·HCl', 157.60, 'Хорошо растворим', 0.0, None, 'Буфер для pH 7.0-9.0'),
        ('Буфер', 'HEPES', 'C8H18N2O4S', 238.30, 'Умеренно растворим', 0.0, None, 'Буфер для pH 6.8-8.2'),
        ('Антибиотик', 'Ампициллин', 'C16H19N3O4S', 349.41, 'Растворим в воде', 0.0, 0.1, 'Бета-лактамный антибиотик'),
        ('Антибиотик', 'Канамицин', 'C18H36N4O11', 484.50, 'Растворим', 0.0, 0.05, 'Аминогликозидный антибиотик'),
        ('Антибиотик', 'Тетрациклин', 'C22H24N2O8', 444.44, 'Слабо растворим', 0.0, 0.2, 'Антибиотик широкого спектра'),
        ('Антибиотик', 'Хлорамфеникол', 'C11H12Cl2N2O5', 323.13, 'Слабо растворим', 0.0, 0.15, 'Бактериостатический антибиотик'),
        ('Антибиотик', 'Гентамицин', 'C21H43N5O7', 477.60, 'Растворим', 0.0, 0.08, 'Аминогликозид'),
        ('Пигмент', 'Кристаллический фиолетовый', 'C25H30ClN3', 407.98, 'Растворим', 0.0, 0.01, 'Для дифференциальной окраски'),
        ('Индикатор', 'Феноловый красный', 'C19H14O5S', 354.38, 'Растворим', 0.0, None, 'Индикатор pH'),
        ('Желеобразующий агент', 'Агар', 'Полисахарид', None, 'Набухает в горячей воде', 0.0, None, 'Для твердых сред')
    ]
    
    cursor.execute("SELECT COUNT(*) FROM substances")
    if cursor.fetchone()[0] == 0:
        cursor.executemany('''
        INSERT INTO substances (substance_class, name, formula, molecular_weight, solubility, energy_value, toxic_concentration, description)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        ''', substances_data)
    
    # Типы взаимодействий (20 записей)
    interactions_data = [
        ('Синергия (+/+)', 'Синтрофия', 'Взаимный метаболический обмен, где продукт метаболизма одного организма используется другим', 'Модель с перекрестным питанием', 0.8, 0.7, 0.01),
        ('Синергия (+/+)', 'Мутуализм', 'Оба организма получают пользу от совместного существования', 'Модель типа Лотки-Вольтерра', 1.2, 1.1, 0.05),
        ('Антагонизм (+/-)', 'Продукция антибиотика', 'Один организм производит антибиотик, ингибирующий рост другого', 'Модель ингибирования', -0.9, 0.5, 0.02),
        ('Антагонизм (+/-)', 'Конкуренция за ресурс', 'Организмы конкурируют за ограниченные питательные вещества', 'Конкурентная модель Лотки-Вольтерра', -0.7, -0.6, 0.03),
        ('Конкуренция (-/-)', 'Прямая конкуренция', 'Оба организма угнетают рост друг друга', 'Модель конкурентного исключения', -0.5, -0.5, 0.01),
        ('Синергия (+/+)', 'Комменсализм', 'Один организм получает пользу, другой не страдает', 'Линейная модель зависимости', 0.0, 0.6, 0.02),
        ('Антагонизм (+/-)', 'Хищничество', 'Один организм потребляет другой', 'Модель хищник-жертва', -1.5, 0.8, 0.005),
        ('Синергия (+/+)', 'Симбиоз с образованием биопленки', 'Организмы совместно образуют биопленку', 'Модель кооперации', 1.0, 1.0, 0.001),
        ('Антагонизм (+/-)', 'Кворум-сенсинг ингибирование', 'Один организм ингибирует систему чувства кворума другого', 'Модель ингибирования сигнальных молекул', -0.4, 0.2, 0.01),
        ('Синергия (+/+)', 'Перекрестная защита', 'Один организм защищает другой от внешних факторов', 'Модель кооперативной защиты', 0.3, 0.5, 0.02),
        ('Антагонизм (+/-)', 'Продукция бактериоцина', 'Производство белковых токсинов, специфичных для родственных штаммов', 'Модель токсин-антитоксин', -0.8, 0.3, 0.015),
        ('Конкуренция (-/-)', 'Конкуренция за адгезионные сайты', 'Борьба за места прикрепления на поверхности', 'Пространственная конкуренция', -0.6, -0.6, 0.001),
        ('Синергия (+/+)', 'Метаболическая кооперация', 'Совместное разложение сложных субстратов', 'Кооперативная модель разложения', 0.9, 0.8, 0.02),
        ('Антагонизм (+/-)', 'Изменение pH среды', 'Один организм изменяет pH, делая среду неблагоприятной для другого', 'Модель pH-ингибирования', -0.5, 0.1, 0.05),
        ('Синергия (+/+)', 'Синтез витаминов', 'Один организм производит витамины, необходимые другому', 'Модель взаимного дополнения', 0.4, 0.6, 0.03),
        ('Антагонизм (+/-)', 'Продукция летучих жирных кислот', 'Накопление кислот, ингибирующих рост конкурентов', 'Модель кислотного ингибирования', -0.7, 0.2, 0.04),
        ('Конкуренция (-/-)', 'Конкуренция за кислород', 'Борьба за растворенный кислород в аэробных условиях', 'Модель кислородной конкуренции', -0.8, -0.7, 0.005),
        ('Синергия (+/+)', 'Детоксикация среды', 'Один организм удаляет токсичные соединения для другого', 'Модель детоксикации', 0.5, 0.7, 0.02),
        ('Антагонизм (+/-)', 'Сидерофорная конкуренция', 'Конкуренция за железо путем производства сидерофоров', 'Модель хелатной конкуренции', -0.6, 0.4, 0.01),
        ('Синергия (+/+)', 'Кооперативная подвижность', 'Совместное движение к благоприятным условиям', 'Кооперативная модель миграции', 0.3, 0.4, 0.015)
    ]
    
    cursor.execute("SELECT COUNT(*) FROM interactions")
    if cursor.fetchone()[0] == 0:
        cursor.executemany('''
        INSERT INTO interactions (base_type, mechanism, description, mathematical_model, alpha_coefficient, beta_coefficient, distance_effect)
        VALUES (?, ?, ?, ?, ?, ?, ?)
        ''', interactions_data)
    
    # Параметры биореактора (20 записей)
    bioreactor_data = [
        ('Статическая чашка', 'Чашка Петри 90 мм', 0.02, 63.6, 0, 0.01, 'Полистирол', 0.005, 'Стандартная чашка для культивирования на агаре'),
        ('Статическая чашка', 'Чашка Петри 60 мм', 0.01, 28.3, 0, 0.008, 'Полистирол', 0.004, 'Малая чашка для скрининга'),
        ('Шейкер', 'Колба Эрленмейера 250 мл', 0.25, None, 200, 0.15, 'Стекло', 0.08, 'Стандартная колба для выращивания в шейкере'),
        ('Шейкер', 'Колба Эрленмейера 500 мл', 0.5, None, 200, 0.18, 'Стекло', 0.1, 'Колба среднего объема'),
        ('Шейкер', 'Колба Эрленмейера 1000 мл', 1.0, None, 180, 0.2, 'Стекло', 0.12, 'Большая колба для масштабирования'),
        ('Хемостат', 'Лабораторный биореактор 1 л', 1.0, None, 400, 0.5, 'Стекло/нерж. сталь', 0.3, 'Непрерывное культивирование с контролем параметров'),
        ('Хемостат', 'Биореактор 5 л', 5.0, None, 300, 0.6, 'Нержавеющая сталь', 0.4, 'Пилотный масштаб'),
        ('Хемостат', 'Биореактор 10 л', 10.0, None, 250, 0.7, 'Нержавеющая сталь', 0.5, 'Полупромышленный масштаб'),
        ('Фед-батч', 'Биореактор 2 л с подачей', 2.0, None, 350, 0.55, 'Стекло', 0.35, 'Периодическая подача субстрата'),
        ('Фед-батч', 'Биореактор 7 л с контролем pH', 7.0, None, 280, 0.65, 'Нержавеющая сталь', 0.45, 'С автоматическим контролем pH и DO'),
        ('Микротитратор', '96-луночный планшет', 0.0002, 0.32, 0, 0.005, 'Полистирол', 0.002, 'Для высокопроизводительного скрининга'),
        ('Микротитратор', '24-луночный планшет', 0.001, 1.8, 0, 0.01, 'Полистирол', 0.006, 'Для экспериментов со средней пропускной способностью'),
        ('Микрожидкостный', 'Микрофлюидный чип 10 нл', 0.00000001, None, 0, 0.001, 'PDMS/Стекло', 0.001, 'Для исследования отдельных клеток'),
        ('Анаэробная камера', 'Анаэробная станция', 100.0, 10000.0, 0, 0.02, 'Плексиглас/Металл', 0.0001, 'Для культивирования строгих анаэробов'),
        ('Культиватор водорослей', 'Фотобиореактор 3 л', 3.0, None, 150, 0.4, 'Стекло', 0.25, 'С подсветкой для фотосинтезирующих организмов'),
        ('Микроаэрофильный', 'Система с контролем O2 2 л', 2.0, None, 100, 0.3, 'Стекло', 0.02, 'Для микроаэрофильных микроорганизмов'),
        ('Колебательный', 'Шейкер с линейным перемешиванием', 0.1, None, 120, 0.12, 'Стекло', 0.07, 'Альтернатива вращательному перемешиванию'),
        ('Мини-биореактор', 'Параллельная система 8×100 мл', 0.1, None, 400, 0.25, 'Стекло', 0.15, 'Для параллельных экспериментов'),
        ('Трубчатый', 'Петлевой биореактор 2 л', 2.0, None, 200, 0.35, 'Стекло', 0.2, 'С циркуляцией через насос'),
        ('Качающийся', 'Рокуер для клеток животных 1 л', 1.0, None, 20, 0.08, 'Поликарбонат', 0.05, 'Для чувствительных к сдвигу культур')
    ]
    
    cursor.execute("SELECT COUNT(*) FROM bioreactor_params")
    if cursor.fetchone()[0] == 0:
        cursor.executemany('''
        INSERT INTO bioreactor_params (system_type, configuration, volume, area, stirring_speed, mass_transfer_coefficient, material, oxygen_transfer_rate, description)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
        ''', bioreactor_data)
    
    # Антимикробные агенты (25 записей)
    antimicrobials_data = [
        ('Антибиотик', 'Ампициллин', 'Клеточная стенка (PBP)', '2-8 мкг/мл', 'Бета-лактамазы', 'мкг/мл', 'Грам+ и некоторые Грам- бактерии'),
        ('Антибиотик', 'Канамицин', '30S субъединица рибосомы', '4-16 мкг/мл', 'Аминогликозид-модифицирующие ферменты', 'мкг/мл', 'Широкий спектр'),
        ('Антибиотик', 'Тетрациклин', '30S субъединица рибосомы', '1-4 мкг/мл', 'Эффлюксные насосы, защита рибосом', 'мкг/мл', 'Широкий спектр'),
        ('Антибиотик', 'Хлорамфеникол', '50S субъединица рибосомы', '2-8 мкг/мл', 'Ацетилтрансферазы', 'мкг/мл', 'Широкий спектр'),
        ('Антибиотик', 'Гентамицин', '30S субъединица рибосомы', '0.5-4 мкг/мл', 'Аминогликозид-модифицирующие ферменты', 'мкг/мл', 'Грам- бактерии, некоторые Грам+'),
        ('Антибиотик', 'Ципрофлоксацин', 'ДНК-гираза', '0.25-1 мкг/мл', 'Мутации в ДНК-гиразе, эффлюкс', 'мкг/мл', 'Широкий спектр'),
        ('Антибиотик', 'Эритромицин', '50S субъединица рибосомы', '0.5-2 мкг/мл', 'Метилазы 23S рРНК, эффлюкс', 'мкг/мл', 'Грам+ бактерии'),
        ('Антибиотик', 'Ванкомицин', 'Клеточная стенка (пептидогликан)', '1-4 мкг/мл', 'Изменение мишени (VanA, VanB)', 'мкг/мл', 'Грам+ бактерии'),
        ('Антибиотик', 'Метронидазол', 'ДНК (нитроредуктаза)', '4-16 мкг/мл', 'Снижение активации, эффлюкс', 'мкг/мл', 'Анаэробы, простейшие'),
        ('Антибиотик', 'Рифампицин', 'РНК-полимераза', '0.5-2 мкг/мл', 'Мутации в RNA-полимеразе', 'мкг/мл', 'Mycobacterium, некоторые Грам+'),
        ('Бактериоцин', 'Низин', 'Клеточная стенка (липид II)', '10-100 МЕ/мл', 'Изменение мишени, деградация', 'МЕ/мл', 'Грам+ бактерии'),
        ('Бактериоцин', 'Субтилин', 'Клеточная стенка', '50-200 МЕ/мл', 'Протеолитическая деградация', 'МЕ/мл', 'Грам+ бактерии'),
        ('Бактериоцин', 'Колицин', 'Мембрана/ДНК', '1-10 мкг/мл', 'Иммунные белки', 'мкг/мл', 'E. coli и родственные'),
        ('Бактериоцин', 'Лактоцин', 'Мембрана', '5-50 мкг/мл', 'Модификация рецепторов', 'мкг/мл', 'Молочнокислые бактерии'),
        ('Дезинфектант', 'Этанол 70%', 'Денатурация белков, мембраны', '70%', 'Повышенная устойчивость мембран', '%', 'Широкий спектр'),
        ('Дезинфектант', 'Хлоргексидин', 'Мембрана', '0.5-4%', 'Эффлюксные насосы', '%', 'Широкий спектр'),
        ('Дезинфектант', 'Перекись водорода', 'Окислительный стресс', '3-6%', 'Каталаза, пероксидаза', '%', 'Широкий спектр'),
        ('Дезинфектант', 'Йод', 'Окисление SH-групп', '1-2%', 'Не специфична', '%', 'Широкий спектр'),
        ('Дезинфектант', 'Глутаровый альдегид', 'Сшивание белков', '2%', 'Повышенная экспрессия шаперонов', '%', 'Широкий спектр, споры'),
        ('Антисептик', 'Повидон-йод', 'Окисление', '10%', 'Биопленки защищают', '%', 'Широкий спектр'),
        ('Антисептик', 'Триклозан', 'Синтез жирных кислот', '0.2-2%', 'Мутации в enoyl-ACP редуктазе', '%', 'Грам+ бактерии'),
        ('Антимикотик', 'Нистатин', 'Мембрана (эргостерол)', '100-500 Ед/мл', 'Снижение содержания эргостерола', 'Ед/мл', 'Грибы'),
        ('Антимикотик', 'Амфотерицин B', 'Мембрана (эргостерол)', '0.5-2 мкг/мл', 'Модификация эргостерола', 'мкг/мл', 'Грибы'),
        ('Антимикотик', 'Флуконазол', 'Синтез эргостерола', '1-4 мкг/мл', 'Эффлюкс, мутации цитохрома P450', 'мкг/мл', 'Candida spp.'),
        ('Консервант', 'Бензоат натрия', 'Кислотный стресс', '0.1-0.2%', 'Повышенная устойчивость к кислотам', '%', 'Грибы, бактерии')
    ]
    
    cursor.execute("SELECT COUNT(*) FROM antimicrobials")
    if cursor.fetchone()[0] == 0:
        cursor.executemany('''
        INSERT INTO antimicrobials (agent_class, name, target, typical_mic, resistance_mechanism, concentration_unit, spectrum)
        VALUES (?, ?, ?, ?, ?, ?, ?)
        ''', antimicrobials_data)
    
    # Метаболические пути/продукты (25 записей)
    metabolic_pathways_data = [
        ('Конечный метаболит', 'Молочная кислота', 'Lactobacillus spp., Streptococcus spp.', 'Гликолиз → пируват → лактат', 6.5, 37.0, 'Экспоненциальная', 0.9, 'Гомоферментативное молочнокислое брожение'),
        ('Конечный метаболит', 'Уксусная кислота', 'Acetobacter spp., Clostridium spp.', 'Этанол → ацетальдегид → уксусная кислота', 5.5, 30.0, 'Стационарная', 0.8, 'Уксуснокислое брожение'),
        ('Конечный метаболит', 'Этанол', 'Saccharomyces cerevisiae, Zymomonas mobilis', 'Гликолиз → пируват → ацетальдегид → этанол', 5.0, 30.0, 'Экспоненциальная', 0.45, 'Спиртовое брожение'),
        ('Конечный метаболит', 'Масляная кислота', 'Clostridium butyricum', 'Гликолиз → ацетил-КоА → масляная кислота', 6.8, 37.0, 'Стационарная', 0.3, 'Маслянокислое брожение'),
        ('Конечный метаболит', 'Пропионовая кислота', 'Propionibacterium spp.', 'Пируват → пропионат через метилмалонил-КоА', 7.0, 30.0, 'Стационарная', 0.4, 'Пропионовокислое брожение'),
        ('Фермент', 'Амилаза', 'Bacillus subtilis, Aspergillus oryzae', 'Экспрессия генов amyE, glaA', 6.5, 37.0, 'Экспоненциальная', 0.1, 'Гидролиз крахмала до сахаров'),
        ('Фермент', 'Протеаза', 'Bacillus licheniformis', 'Экспрессия генов субтилизина', 8.0, 50.0, 'Стационарная', 0.08, 'Расщепление белков'),
        ('Фермент', 'Липаза', 'Candida rugosa', 'Индукция липидами', 7.0, 40.0, 'Экспоненциальная', 0.05, 'Гидролиз жиров'),
        ('Фермент', 'Целлюлаза', 'Trichoderma reesei', 'Индукция целлюлозой', 5.0, 28.0, 'Стационарная', 0.06, 'Разложение целлюлозы'),
        ('Вторичный метаболит', 'Пенициллин', 'Penicillium chrysogenum', 'ACV-синтетаза → изопенициллин N-синтаза', 6.5, 25.0, 'Трофофаза', 0.02, 'Бета-лактамный антибиотик'),
        ('Вторичный метаболит', 'Стрептомицин', 'Streptomyces griseus', 'Путь стрептомицина из глюкозы', 7.2, 28.0, 'Идиофаза', 0.015, 'Аминогликозидный антибиотик'),
        ('Вторичный метаболит', 'Тетрациклин', 'Streptomyces aureofaciens', 'Поликетидный путь', 6.8, 28.0, 'Идиофаза', 0.012, 'Антибиотик широкого спектра'),
        ('Вторичный метаболит', 'Ловастатин', 'Aspergillus terreus', 'Поликетидный синтазный путь', 6.0, 28.0, 'Стационарная', 0.008, 'Ингибитор ГМГ-КоА редуктазы'),
        ('Газы', 'Диоксид углерода (CO2)', 'Практически все микроорганизмы', 'Дыхание, брожение', 7.0, 37.0, 'Экспоненциальная', 0.95, 'Конечный продукт дыхания'),
        ('Газы', 'Метан (CH4)', 'Methanobacterium spp.', 'Восстановление CO2 водородом', 7.2, 37.0, 'Стационарная', 0.7, 'Метановое брожение'),
        ('Газы', 'Водород (H2)', 'Clostridium spp.', 'Ферментация пирувата', 6.5, 37.0, 'Экспоненциальная', 0.5, 'Продукт анаэробного метаболизма'),
        ('Газы', 'Сероводород (H2S)', 'Desulfovibrio spp.', 'Восстановление сульфатов', 7.5, 30.0, 'Стационарная', 0.3, 'Сульфатредукция'),
        ('Конечный метаболит', 'Лимонная кислота', 'Aspergillus niger', 'Гликолиз → пируват → цитрат', 3.5, 30.0, 'Стационарная', 0.85, 'Накопление в условиях дефицита'),
        ('Конечный метаболит', 'Глюконовая кислота', 'Aspergillus niger, Gluconobacter spp.', 'Окисление глюкозы глюкозооксидазой', 6.5, 30.0, 'Экспоненциальная', 0.9, 'Биоконверсия глюкозы'),
        ('Фермент', 'Глюкозоизомераза', 'Streptomyces olivaceus', 'Индукция ксилозой', 7.5, 60.0, 'Стационарная', 0.07, 'Превращение глюкозы во фруктозу'),
        ('Фермент', 'Пектиназа', 'Aspergillus niger', 'Индукция пектином', 4.5, 40.0, 'Стационарная', 0.06, 'Гидролиз пектина'),
        ('Вторичный метаболит', 'Гибберелловая кислота', 'Gibberella fujikuroi', 'Дитерпеноидный путь', 3.5, 25.0, 'Идиофаза', 0.01, 'Фитогормон'),
        ('Вторичный метаболит', 'Циклоспорин', 'Tolypocladium inflatum', 'Нерибосомный пептидный синтез', 6.0, 24.0, 'Идиофаза', 0.005, 'Иммунодепрессант'),
        ('Конечный метаболит', 'Ацетон', 'Clostridium acetobutylicum', 'Ацетоацетат → ацетон', 5.5, 37.0, 'Стационарная', 0.2, 'Ацетон-бутанол-этаноловое брожение'),
        ('Конечный метаболит', 'Изопрен', 'Различные бактерии и растения', 'Мевалионатный путь или MEP путь', 7.0, 30.0, 'Экспоненциальная', 0.001, 'Летучий углеводород')
    ]
    
    cursor.execute("SELECT COUNT(*) FROM metabolic_pathways")
    if cursor.fetchone()[0] == 0:
        cursor.executemany('''
        INSERT INTO metabolic_pathways (product_type, product_name, producing_strains, biosynthesis_pathway, optimal_ph, optimal_temperature, growth_phase, yield, description)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
        ''', metabolic_pathways_data)
    
    # Экспериментальные протоколы (20 записей)
    experimental_protocols_data = [
        ('Выделение', 'Выделение чистых культур методом штриха', '1. Стерильной петлей зачерпнуть культуру. 2. Нанести на поверхность агара и сделать несколько штрихов. 3. Инкубировать при оптимальной температуре. 4. Отобрать отдельные колонии.', 'Чашка Петри, питательный агар, инокуляционная петля, горелка', 'Чистота культуры = (число целевых колоний / общее число колоний) × 100%', 'Стандартный метод микробиологии', 10, 'Начинающий'),
        ('Идентификация', 'Окраска по Граму', '1. Нанести мазок на предметное стекло. 2. Высушить и зафиксировать. 3. Окрасить кристаллическим фиолетовым. 4. Промыть, обработать йодом. 5. Обесцветить спиртом. 6. Докрасить фуксином.', 'Предметные стекла, красители, микроскоп, иммерсионное масло', 'Грам+ = синие/фиолетовые, Грам- = розовые/красные', 'Основной метод дифференциации бактерий', 15, 'Начинающий'),
        ('Тест на чувствительность', 'Диск-диффузионный метод', '1. Приготовить суспензию микроорганизма. 2. Нанести на чашку с агаром. 3. Разместить диски с антибиотиками. 4. Инкубировать 18-24 часа. 5. Измерить зоны ингибирования.', 'Диски с антибиотиками, штангенциркуль, питательный агар', 'Чувствительность по таблице CLSI/EUCAST', '', 1440, 'Средний'),
        ('Кинетика роста', 'Измерение оптической плотности', '1. Взять культуру в экспоненциальной фазе. 2. Развести до OD600 = 0.1. 3. Измерять каждые 30-60 минут. 4. Строить кривую роста. 5. Рассчитать удельную скорость роста.', 'Спектрофотометр, кюветы, термостатируемый шейкер', 'µ = (lnOD2 - lnOD1) / (t2 - t1)', 'Стандартный метод', 480, 'Средний'),
        ('Количественное определение', 'Метод серийных разведений', '1. Приготовить ряд пробирок с двукратными разведениями. 2. Внести одинаковый объем культуры. 3. Инкубировать. 4. Определить минимальную ингибирующую концентрацию.', 'Пробирки, пипетки, жидкая среда', 'МИК = наименьшая концентрация без видимого роста', 'Для определения МИК антибиотиков', 1440, 'Средний'),
        ('Выделение', 'Выделение из почвы методом разведений', '1. Взвесить 1 г почвы. 2. Суспендировать в 9 мл физраствора. 3. Сделать серию десятикратных разведений. 4. Высеять на чашки. 5. Инкубировать.', 'Физраствор, пробирки, чашки Петри', 'КОЕ/г = (число колоний × коэффициент разведения) / объем посева', 'Для подсчета микроорганизмов в образцах', 60, 'Начинающий'),
        ('Идентификация', 'Тест на каталазу', '1. На предметное стекло нанести перекись водорода (3%). 2. Петлей внести исследуемую культуру. 3. Наблюдать образование пузырьков.', 'Перекись водорода, предметное стекло', 'Каталаза+ = пузырьки, каталаза- = отсутствие пузырьков', 'Быстрый тест', 5, 'Начинающий'),
        ('Идентификация', 'Тест на оксидазу', '1. На фильтровальную бумагу нанести реагент. 2. Петлей внести культуру. 3. Наблюдать изменение цвета.', 'Оксидазные полоски или реактив', 'Оксидаза+ = сине-фиолетовое окрашивание за 10-30 сек', 'Для идентификации Pseudomonas, Neisseria', 5, 'Начинающий'),
        ('Тест на чувствительность', 'E-тест (Epsilometer test)', '1. Нанести суспензию на чашку. 2. Поместить E-полоску. 3. Инкубировать 18-24 часа. 4. Считать МИК в точке пересечения.', 'E-полоски, чашки с MHA агаром', 'МИК определяется по шкале на полоске', 'Точное определение МИК', 1440, 'Продвинутый'),
        ('Кинетика роста', 'Подсчет в камере Горяева', '1. Приготовить суспензию культуры. 2. Внести в камеру Горяева. 3. Подсчитать клетки под микроскопом. 4. Рассчитать концентрацию.', 'Камера Горяева, микроскоп, покровные стекла', 'Клеток/мл = (среднее число в квадрате × 25 × 10⁴ × разведение)', 'Прямой подсчет клеток', 30, 'Средний'),
        ('Количественное определение', 'Метод мембранной фильтрации', '1. Пропустить образец через мембранный фильтр. 2. Поместить фильтр на питательную среду. 3. Инкубировать. 4. Подсчитать колонии.', 'Мембранные фильтры, установка для фильтрации', 'КОЕ/мл = (число колоний / объем фильтрата) × разведение', 'Для жидкостей с низкой концентрацией', 1440, 'Средний'),
        ('Выделение', 'Метод обогащения', '1. Внести образец в селективную среду. 2. Инкубировать 6-24 часа. 3. Высеять на селективный агар. 4. Выделить чистые культуры.', 'Селективные среды, чашки Петри', 'Эффективность = число выделенных целевых культур / общее число попыток', 'Для выделения редких микроорганизмов', 2880, 'Средний'),
        ('Идентификация', 'API тест-система', '1. Приготовить суспензию культуры. 2. Внести в лунки API полоски. 3. Инкубировать 18-24 часа. 4. Добавить реактивы. 5. Считать код и определить вид.', 'API полоски, реактивы, инкубатор', 'Использовать код для идентификации в базе данных', 'Коммерческая система идентификации', 1440, 'Продвинутый'),
        ('Тест на чувствительность', 'Микробротирование в планшете', '1. Внести ряд разведений антибиотика в лунки. 2. Добавить стандартизованную инокулюм. 3. Инкубировать 18-24 часа. 4. Определить МИК.', '96-луночный планшет, многоканальная пипетка', 'МИК = наименьшая концентрация без помутнения', 'Высокопроизводительный метод', 1440, 'Продвинутый'),
        ('Кинетика роста', 'Измерение сухого веса', '1. Отобрать пробы культуры. 2. Отфильтровать через предварительно взвешенный фильтр. 3. Высушить при 105°C до постоянного веса. 4. Взвесить.', 'Мембранные фильтры, сушильный шкаф, аналитические весы', 'Концентрация = (вес фильтра с биомассой - вес чистого фильтра) / объем пробы', 'Точное определение биомассы', 120, 'Средний'),
        ('Количественное определение', 'МПН метод (титр)', '1. Приготовить 3 ряда из 5 пробирок с средой. 2. Внести разные объемы образца. 3. Инкубировать. 4. Определить число положительных пробирок. 5. Рассчитать по таблице МПН.', 'Пробирки с жидкой средой, таблица МПН', 'МПН/мл = значение из таблицы / средний объем в отрицательных пробирках', 'Для определения численности в гетерогенных образцах', 2880, 'Средний'),
        ('Выделение', 'Выделение анаэробных бактерий', '1. Работать в анаэробной камере. 2. Использовать восстановленные среды. 3. Высевать методом истощающего штриха. 4. Инкубировать в анаэробных условиях.', 'Анаэробная камера, GasPak системы, восстановленные среды', 'Эффективность выделения = (число анаэробных культур / общее число культур) × 100%', 'Специальные условия для анаэробов', 60, 'Продвинутый'),
        ('Идентификация', 'ПЦР идентификация', '1. Выделить ДНК. 2. Поставить ПЦР с видоспецифичными праймерами. 3. Провести электрофорез. 4. Проанализировать результат.', 'ПЦР-амплификатор, наборы для ПЦР, гель-электрофорез', 'Определение по размеру ампликона', 'Молекулярно-биологический метод', 240, 'Продвинутый'),
        ('Тест на чувствительность', 'Определение MBC', '1. Определить МИК. 2. Из лунок без видимого роста сделать высевы на агар. 3. Инкубировать. 4. Определить минимальную бактерицидную концентрацию.', 'Чашки с агаром, петля', 'MBC = наименьшая концентрация, убивающая 99.9% клеток', 'Определение бактерицидной активности', 2880, 'Продвинутый'),
        ('Кинетика роста', 'Непрерывное культивирование в хемостате', '1. Установить скорость разбавления. 2. Довести культуру до стационарного состояния. 3. Отбирать пробы через равные промежутки. 4. Определять параметры роста.', 'Хемостат, перистальтический насос, сбор проб', 'Удельная скорость роста µ = скорость разбавления D', 'Изучение физиологии в стационарных условиях', 5760, 'Продвинутый')
    ]
    
    cursor.execute("SELECT COUNT(*) FROM experimental_protocols")
    if cursor.fetchone()[0] == 0:
        cursor.executemany('''
        INSERT INTO experimental_protocols (experiment_purpose, protocol_name, step_by_step, materials, calculation_formulas, "references", duration_minutes, difficulty_level)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        ''', experimental_protocols_data)
    
    conn.commit()
    print("База данных предзаполнена данными!")

if __name__ == "__main__":
    init_database()